<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Column Layout Scholarship Generator Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f8f9fa;
        }
        .test-section h3 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        button:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin: 15px 0;
            align-items: center;
        }
        select, input {
            padding: 8px 12px;
            border: 1px solid #ced4da;
            border-radius: 4px;
            font-size: 14px;
        }
        .layout-preview {
            border: 2px dashed #007bff;
            padding: 20px;
            margin: 15px 0;
            border-radius: 8px;
            background: #f8f9fa;
        }
        .preview-grid {
            display: grid;
            gap: 4px;
            margin: 15px 0;
        }
        .landscape-grid {
            grid-template-columns: repeat(6, 1fr);
        }
        .portrait-grid {
            grid-template-columns: repeat(4, 1fr);
        }
        .preview-item {
            background: #e9ecef;
            border: 1px solid #ced4da;
            border-radius: 4px;
            padding: 8px;
            text-align: center;
            font-size: 10px;
            min-height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .logs {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 15px;
            border-radius: 8px;
            max-height: 300px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Column Layout Generator Test</h1>
            <p>Test the new column-based layout that fits up to 18 scholarships on one page</p>
        </div>

        <!-- Layout Configuration -->
        <div class="test-section">
            <h3>üìê Layout Configuration</h3>
            <div class="controls">
                <label>Orientation:</label>
                <select id="orientation">
                    <option value="landscape">Landscape (6 columns)</option>
                    <option value="portrait">Portrait (4 columns)</option>
                </select>

                <label>Number of Scholarships:</label>
                <select id="scholarship-count">
                    <option value="6">6 Scholarships</option>
                    <option value="12">12 Scholarships</option>
                    <option value="18">18 Scholarships</option>
                    <option value="20">20 Scholarships</option>
                </select>

                <button onclick="updatePreview()">Update Preview</button>
            </div>

            <div class="layout-preview">
                <h4>Layout Preview:</h4>
                <div id="layout-description"></div>
                <div id="layout-preview" class="preview-grid landscape-grid"></div>
            </div>
        </div>

        <!-- Authentication -->
        <div class="test-section">
            <h3>üîê Authentication</h3>
            <div class="controls">
                <input type="text" id="username" placeholder="Username" value="admin">
                <input type="password" id="password" placeholder="Password" value="">
                <button onclick="testLogin()">Login</button>
            </div>
            <div id="auth-status"></div>
        </div>

        <!-- Test Generation -->
        <div class="test-section">
            <h3>üìÑ Test Column Layout Generation</h3>
            <div class="controls">
                <button onclick="generateTestPDF()">Generate Test PDF</button>
                <button onclick="generateTestImage()">Generate Test Image</button>
                <button onclick="createTestScholarships()">Create Test Data</button>
            </div>
            <div id="generation-status"></div>
        </div>

        <!-- Logs -->
        <div class="test-section">
            <h3>üìù Test Logs</h3>
            <button onclick="clearLogs()">Clear Logs</button>
            <div id="logs" class="logs"></div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8002';
        let authToken = '';

        function log(message, type = 'info') {
            const logs = document.getElementById('logs');
            const timestamp = new Date().toLocaleTimeString();
            logs.innerHTML += `<div>[${timestamp}] [${type.toUpperCase()}] ${message}</div>`;
            logs.scrollTop = logs.scrollHeight;
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        function clearLogs() {
            document.getElementById('logs').innerHTML = '';
        }

        function updatePreview() {
            const orientation = document.getElementById('orientation').value;
            const count = parseInt(document.getElementById('scholarship-count').value);

            const preview = document.getElementById('layout-preview');
            const description = document.getElementById('layout-description');

            // Update grid class
            preview.className = `preview-grid ${orientation === 'landscape' ? 'landscape-grid' : 'portrait-grid'}`;

            // Calculate layout
            const columns = orientation === 'landscape' ? 6 : 4;
            const rows = Math.ceil(count / columns);

            description.innerHTML = `
                <strong>Layout:</strong> ${columns} columns √ó ${rows} rows = ${columns * rows} slots<br>
                <strong>Scholarships:</strong> ${count} (${columns * rows - count} empty slots)<br>
                <strong>Page Utilization:</strong> ${Math.round((count / (columns * rows)) * 100)}%
            `;

            // Generate preview items
            let html = '';
            for (let i = 1; i <= count; i++) {
                html += `<div class="preview-item">Scholarship ${i}</div>`;
            }
            // Add empty slots
            for (let i = count + 1; i <= columns * rows; i++) {
                html += `<div class="preview-item" style="background: #fff; border-style: dashed;">Empty</div>`;
            }

            preview.innerHTML = html;

            log(`Updated preview: ${orientation}, ${count} scholarships, ${columns}√ó${rows} grid`);
        }

        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            log(`Attempting login with username: ${username}`);
            try {
                const response = await fetch(`${API_URL}/api/auth/admin-login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.data.token;
                    showStatus('auth-status', `‚úÖ Login successful! User: ${data.data.user.username}`, 'success');
                    log(`Login successful: ${JSON.stringify(data.data.user)}`);
                } else {
                    showStatus('auth-status', `‚ùå Login failed: ${data.error}`, 'error');
                    log(`Login failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('auth-status', `‚ùå Login error: ${error.message}`, 'error');
                log(`Login error: ${error.message}`, 'error');
            }
        }

        async function createTestScholarships() {
            if (!authToken) {
                showStatus('generation-status', '‚ùå Please login first', 'error');
                return;
            }

            const testScholarships = [
                { title: "STEM Excellence Scholarship", amount: "$5,000", deadline: "2024-12-31", status: "active" },
                { title: "Community Leadership Award", amount: "$3,000", deadline: "2024-11-15", status: "active" },
                { title: "Academic Merit Scholarship", amount: "$7,500", deadline: "2024-12-01", status: "active" },
                { title: "Innovation in Technology", amount: "$4,000", deadline: "2024-10-30", status: "active" },
                { title: "Future Leaders Program", amount: "$6,000", deadline: "2024-11-30", status: "active" },
                { title: "Global Citizenship Award", amount: "$2,500", deadline: "2024-12-15", status: "active" },
                { title: "Environmental Sustainability", amount: "$3,500", deadline: "2024-11-01", status: "active" },
                { title: "Healthcare Heroes Fund", amount: "$5,500", deadline: "2024-12-10", status: "active" },
                { title: "Arts & Culture Scholarship", amount: "$4,500", deadline: "2024-11-20", status: "active" },
                { title: "Entrepreneurship Excellence", amount: "$8,000", deadline: "2024-12-05", status: "active" },
                { title: "Social Impact Scholarship", amount: "$3,000", deadline: "2024-11-25", status: "active" },
                { title: "Research Innovation Grant", amount: "$6,500", deadline: "2024-12-20", status: "active" },
                { title: "First Generation College", amount: "$4,000", deadline: "2024-11-10", status: "active" },
                { title: "Women in STEM Award", amount: "$5,000", deadline: "2024-12-12", status: "active" },
                { title: "Diversity & Inclusion Fund", amount: "$3,500", deadline: "2024-11-18", status: "active" },
                { title: "Digital Innovation Prize", amount: "$7,000", deadline: "2024-12-08", status: "active" },
                { title: "Rural Communities Grant", amount: "$2,800", deadline: "2024-11-22", status: "active" },
                { title: "Veterans Education Fund", amount: "$6,200", deadline: "2024-12-18", status: "active" }
            ];

            log('Creating 18 test scholarships for column layout testing...');
            let created = 0;

            for (const scholarship of testScholarships) {
                try {
                    const response = await fetch(`${API_URL}/api/admin/scholarships`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(scholarship)
                    });

                    if (response.ok) {
                        created++;
                        log(`‚úÖ Created: ${scholarship.title}`);
                    }
                } catch (error) {
                    log(`‚ùå Error creating ${scholarship.title}: ${error.message}`);
                }
            }

            showStatus('generation-status', `‚úÖ Created ${created}/${testScholarships.length} test scholarships`, 'success');
            log(`Test scholarship creation completed: ${created} scholarships added`);
        }

        async function generateTestPDF() {
            if (!authToken) {
                showStatus('generation-status', '‚ùå Please login first', 'error');
                return;
            }

            const orientation = document.getElementById('orientation').value;
            const count = parseInt(document.getElementById('scholarship-count').value);

            log(`Generating test PDF: ${orientation}, ${count} scholarships`);

            try {
                // Get active scholarships
                const scholarshipsResponse = await fetch(`${API_URL}/api/admin/scholarships/active`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!scholarshipsResponse.ok) {
                    throw new Error('Failed to fetch scholarships');
                }

                const scholarshipsData = await scholarshipsResponse.json();
                const scholarships = scholarshipsData.data.slice(0, count);

                if (scholarships.length === 0) {
                    showStatus('generation-status', '‚ùå No scholarships available. Create test data first.', 'error');
                    return;
                }

                // Generate PDF
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: scholarships,
                        format: 'pdf',
                        orientation: orientation,
                        includeLinks: false,
                        template: 'table'
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const url = window.URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `column_layout_${orientation}_${count}_scholarships.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    window.URL.revokeObjectURL(url);
                    document.body.removeChild(a);

                    showStatus('generation-status', `‚úÖ Column layout PDF generated! (${orientation}, ${count} scholarships)`, 'success');
                    log(`PDF generation successful: ${orientation}, ${count} scholarships`);
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'PDF generation failed');
                }
            } catch (error) {
                showStatus('generation-status', `‚ùå PDF generation failed: ${error.message}`, 'error');
                log(`PDF generation error: ${error.message}`, 'error');
            }
        }

        async function generateTestImage() {
            if (!authToken) {
                showStatus('generation-status', '‚ùå Please login first', 'error');
                return;
            }

            const orientation = document.getElementById('orientation').value;
            const count = parseInt(document.getElementById('scholarship-count').value);

            log(`Generating test image: ${orientation}, ${count} scholarships`);

            try {
                // Get active scholarships
                const scholarshipsResponse = await fetch(`${API_URL}/api/admin/scholarships/active`, {
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    }
                });

                if (!scholarshipsResponse.ok) {
                    throw new Error('Failed to fetch scholarships');
                }

                const scholarshipsData = await scholarshipsResponse.json();
                const scholarships = scholarshipsData.data.slice(0, count);

                if (scholarships.length === 0) {
                    showStatus('generation-status', '‚ùå No scholarships available. Create test data first.', 'error');
                    return;
                }

                // Generate Image
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: scholarships,
                        format: 'image',
                        orientation: orientation,
                        includeLinks: true,
                        template: 'table'
                    })
                });

                const data = await response.json();

                if (data.success) {
                    showStatus('generation-status', `‚úÖ Column layout image generated! Opening preview...`, 'success');
                    log(`Image generation successful: ${orientation}, ${count} scholarships`);

                    // Open in new window
                    const newWindow = window.open();
                    newWindow.document.write(data.data.html_content);
                    newWindow.document.close();
                } else {
                    throw new Error(data.error || 'Image generation failed');
                }
            } catch (error) {
                showStatus('generation-status', `‚ùå Image generation failed: ${error.message}`, 'error');
                log(`Image generation error: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            log('Column Layout Test initialized');
            updatePreview();
        };
    </script>
</body>
</html>