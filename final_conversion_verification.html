<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Conversion Features Verification</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
            color: #333;
        }
        .feature-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin: 30px 0;
        }
        .feature-section {
            border: 2px solid #007bff;
            border-radius: 15px;
            padding: 25px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
        }
        .feature-title {
            font-size: 20px;
            font-weight: bold;
            color: #007bff;
            margin-bottom: 15px;
            text-align: center;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        .test-section {
            margin: 20px 0;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 10px;
            background: #f8f9fa;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
            transition: all 0.3s ease;
            width: 100%;
        }
        button:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        button.success {
            background: #28a745;
        }
        button.success:hover {
            background: #1e7e34;
        }
        .status {
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            font-weight: 500;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .scholarship-selector {
            margin: 15px 0;
        }
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        .feature-description {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #007bff;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
        }
        .stat-number {
            font-size: 24px;
            font-weight: bold;
            color: #007bff;
        }
        .stat-label {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Final Conversion Features Verification</h1>
            <p>Comprehensive testing of both table conversion and individual scholarship detail generation</p>
        </div>

        <!-- Authentication -->
        <div class="test-section">
            <h3>üîê Authentication</h3>
            <input type="text" id="username" placeholder="Username" value="admin">
            <input type="password" id="password" placeholder="Password" value="">
            <button onclick="testLogin()">Login & Load Scholarships</button>
            <div id="auth-status"></div>
        </div>

        <!-- Statistics Dashboard -->
        <div class="stats">
            <div class="stat-item">
                <div class="stat-number" id="total-scholarships">0</div>
                <div class="stat-label">Total Active Scholarships</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="future-deadlines">0</div>
                <div class="stat-label">Future Deadlines</div>
            </div>
            <div class="stat-item">
                <div class="stat-number" id="generated-pdfs">0</div>
                <div class="stat-label">PDFs Generated</div>
            </div>
        </div>

        <!-- Feature Grid -->
        <div class="feature-grid">
            <!-- Table Conversion Feature -->
            <div class="feature-section">
                <div class="feature-title">üìä Table Form Conversion</div>
                <div class="feature-description">
                    <strong>18 Scholarships per Page</strong><br>
                    ‚Ä¢ 6√ó3 Grid Layout in Landscape Mode<br>
                    ‚Ä¢ Company Branding: "Sabiteck Limited"<br>
                    ‚Ä¢ Comprehensive Information Display<br>
                    ‚Ä¢ Optimized for Multiple Scholarships
                </div>

                <button onclick="generate18ScholarshipTable()" id="table-btn">
                    Generate 18-Scholarship Table PDF
                </button>
                <button onclick="generateAllScholarshipsTable()">
                    Generate All Scholarships Table
                </button>
                <button onclick="generateWithLinks()">
                    Generate Table with Links
                </button>

                <div id="table-status"></div>
            </div>

            <!-- Individual Detail Feature -->
            <div class="feature-section">
                <div class="feature-title">üìÑ Individual Detail Conversion</div>
                <div class="feature-description">
                    <strong>Single Scholarship per Page</strong><br>
                    ‚Ä¢ Portrait Mode A4 Layout<br>
                    ‚Ä¢ Full Detailed Information<br>
                    ‚Ä¢ Requirements & Contact Info<br>
                    ‚Ä¢ Professional Single-Page Design
                </div>

                <div class="scholarship-selector">
                    <select id="scholarship-select">
                        <option value="">Select a scholarship for detail generation...</option>
                    </select>
                </div>

                <button onclick="generateIndividualDetail()" id="detail-btn">
                    Generate Individual Detail PDF
                </button>
                <button onclick="generateMultipleDetails()">
                    Generate Top 5 Individual Details
                </button>
                <button onclick="generatePremiumDetails()">
                    Generate Premium Scholarship Details
                </button>

                <div id="detail-status"></div>
            </div>
        </div>

        <!-- Comparison Testing -->
        <div class="test-section">
            <h3>‚öñÔ∏è Feature Comparison & Performance Test</h3>
            <button onclick="runComparisonTest()">Run Complete Comparison Test</button>
            <button onclick="runPerformanceTest()">Test Generation Performance</button>
            <div id="comparison-status"></div>
        </div>

        <!-- Results Summary -->
        <div class="test-section">
            <h3>üìà Test Results Summary</h3>
            <div id="results-summary">
                <p>Run tests to see results...</p>
            </div>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8002';
        let authToken = '';
        let scholarships = [];
        let generatedPDFs = 0;

        function updateStats() {
            document.getElementById('total-scholarships').textContent = scholarships.length;
            const futureCount = scholarships.filter(s => new Date(s.deadline) > new Date()).length;
            document.getElementById('future-deadlines').textContent = futureCount;
            document.getElementById('generated-pdfs').textContent = generatedPDFs;
        }

        function showStatus(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="status ${type}">${message}</div>`;
        }

        async function testLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_URL}/api/auth/admin-login`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });

                const data = await response.json();

                if (data.success) {
                    authToken = data.data.token;
                    showStatus('auth-status', `‚úÖ Login successful! Loading scholarships...`, 'success');
                    await loadScholarships();
                } else {
                    showStatus('auth-status', `‚ùå Login failed: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('auth-status', `‚ùå Login error: ${error.message}`, 'error');
            }
        }

        async function loadScholarships() {
            try {
                const response = await fetch(`${API_URL}/api/admin/scholarships/active`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                const data = await response.json();

                if (data.success) {
                    scholarships = data.data;
                    populateScholarshipSelector();
                    updateStats();
                    showStatus('auth-status', `‚úÖ Loaded ${scholarships.length} active scholarships`, 'success');
                } else {
                    showStatus('auth-status', `‚ùå Failed to load scholarships: ${data.error}`, 'error');
                }
            } catch (error) {
                showStatus('auth-status', `‚ùå Error loading scholarships: ${error.message}`, 'error');
            }
        }

        function populateScholarshipSelector() {
            const select = document.getElementById('scholarship-select');
            select.innerHTML = '<option value="">Select a scholarship for detail generation...</option>';

            scholarships.forEach((scholarship, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = `${scholarship.title} - ${scholarship.currency} ${scholarship.amount}`;
                select.appendChild(option);
            });
        }

        async function generate18ScholarshipTable() {
            if (scholarships.length < 18) {
                showStatus('table-status', '‚ùå Need at least 18 scholarships', 'error');
                return;
            }

            showStatus('table-status', 'üîÑ Generating 18-scholarship table PDF...', 'info');

            try {
                const scholarshipsFor18 = scholarships.slice(0, 18);
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: scholarshipsFor18,
                        format: 'pdf',
                        orientation: 'landscape',
                        includeLinks: false,
                        template: 'table'
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    downloadBlob(blob, 'table_18_scholarships.pdf');
                    generatedPDFs++;
                    updateStats();
                    showStatus('table-status', '‚úÖ 18-scholarship table PDF generated successfully!', 'success');
                } else {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Generation failed');
                }
            } catch (error) {
                showStatus('table-status', `‚ùå Table generation failed: ${error.message}`, 'error');
            }
        }

        async function generateAllScholarshipsTable() {
            showStatus('table-status', `üîÑ Generating table with all ${scholarships.length} scholarships...`, 'info');

            try {
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: scholarships,
                        format: 'pdf',
                        orientation: 'landscape',
                        includeLinks: false,
                        template: 'table'
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    downloadBlob(blob, `all_${scholarships.length}_scholarships_table.pdf`);
                    generatedPDFs++;
                    updateStats();
                    showStatus('table-status', `‚úÖ All ${scholarships.length} scholarships table generated!`, 'success');
                } else {
                    throw new Error('Generation failed');
                }
            } catch (error) {
                showStatus('table-status', `‚ùå All scholarships table failed: ${error.message}`, 'error');
            }
        }

        async function generateWithLinks() {
            const scholarshipsFor18 = scholarships.slice(0, 18);
            showStatus('table-status', 'üîÑ Generating table with application links...', 'info');

            try {
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: scholarshipsFor18,
                        format: 'pdf',
                        orientation: 'landscape',
                        includeLinks: true,
                        template: 'table'
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    downloadBlob(blob, 'table_with_links.pdf');
                    generatedPDFs++;
                    updateStats();
                    showStatus('table-status', '‚úÖ Table with links generated successfully!', 'success');
                } else {
                    throw new Error('Generation failed');
                }
            } catch (error) {
                showStatus('table-status', `‚ùå Links table generation failed: ${error.message}`, 'error');
            }
        }

        async function generateIndividualDetail() {
            const select = document.getElementById('scholarship-select');
            const index = select.value;

            if (index === '') {
                showStatus('detail-status', '‚ùå Please select a scholarship', 'error');
                return;
            }

            const scholarship = scholarships[index];
            showStatus('detail-status', `üîÑ Generating detail for "${scholarship.title}"...`, 'info');

            try {
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate-single`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarship: scholarship,
                        format: 'pdf',
                        includeContact: true,
                        includeRequirements: true
                    })
                });

                if (response.ok) {
                    const blob = await response.blob();
                    const safeName = scholarship.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                    downloadBlob(blob, `${safeName}_detail.pdf`);
                    generatedPDFs++;
                    updateStats();
                    showStatus('detail-status', `‚úÖ Individual detail generated for "${scholarship.title}"!`, 'success');
                } else {
                    throw new Error('Generation failed');
                }
            } catch (error) {
                showStatus('detail-status', `‚ùå Individual detail failed: ${error.message}`, 'error');
            }
        }

        async function generateMultipleDetails() {
            showStatus('detail-status', 'üîÑ Generating details for top 5 scholarships...', 'info');

            const top5 = scholarships.slice(0, 5);
            let successful = 0;

            for (let i = 0; i < top5.length; i++) {
                try {
                    const response = await fetch(`${API_URL}/api/admin/scholarships/generate-single`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            scholarship: top5[i],
                            format: 'pdf',
                            includeContact: true,
                            includeRequirements: true
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const safeName = top5[i].title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                        downloadBlob(blob, `top${i+1}_${safeName.substring(0,15)}_detail.pdf`);
                        successful++;
                        generatedPDFs++;
                    }
                } catch (error) {
                    console.error(`Failed to generate detail for scholarship ${i+1}:`, error);
                }
            }

            updateStats();
            showStatus('detail-status', `‚úÖ Generated ${successful}/5 individual details successfully!`, 'success');
        }

        async function generatePremiumDetails() {
            const premiumScholarships = scholarships.filter(s =>
                parseInt(s.amount) >= 15000 ||
                s.title.includes('AI') ||
                s.title.includes('Leadership') ||
                s.title.includes('Excellence')
            );

            showStatus('detail-status', `üîÑ Generating ${premiumScholarships.length} premium scholarship details...`, 'info');

            let successful = 0;
            for (const scholarship of premiumScholarships) {
                try {
                    const response = await fetch(`${API_URL}/api/admin/scholarships/generate-single`, {
                        method: 'POST',
                        headers: {
                            'Authorization': `Bearer ${authToken}`,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            scholarship: scholarship,
                            format: 'pdf',
                            includeContact: true,
                            includeRequirements: true
                        })
                    });

                    if (response.ok) {
                        const blob = await response.blob();
                        const safeName = scholarship.title.replace(/[^a-z0-9]/gi, '_').toLowerCase();
                        downloadBlob(blob, `premium_${safeName.substring(0,20)}.pdf`);
                        successful++;
                        generatedPDFs++;
                    }
                } catch (error) {
                    console.error('Failed to generate premium detail:', error);
                }
            }

            updateStats();
            showStatus('detail-status', `‚úÖ Generated ${successful}/${premiumScholarships.length} premium details!`, 'success');
        }

        function downloadBlob(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        async function runComparisonTest() {
            showStatus('comparison-status', 'üîÑ Running comprehensive comparison test...', 'info');

            const testScholarship = scholarships[0];
            let results = [];

            // Test 1: Individual vs Table for same scholarship
            try {
                const individualStart = Date.now();
                const individualResponse = await fetch(`${API_URL}/api/admin/scholarships/generate-single`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarship: testScholarship,
                        format: 'pdf',
                        includeContact: true,
                        includeRequirements: true
                    })
                });
                const individualTime = Date.now() - individualStart;
                const individualBlob = await individualResponse.blob();

                const tableStart = Date.now();
                const tableResponse = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: [testScholarship],
                        format: 'pdf',
                        orientation: 'portrait',
                        includeLinks: false,
                        template: 'table'
                    })
                });
                const tableTime = Date.now() - tableStart;
                const tableBlob = await tableResponse.blob();

                results.push(`Individual Detail: ${Math.round(individualBlob.size/1024)}KB in ${individualTime}ms`);
                results.push(`Table Format: ${Math.round(tableBlob.size/1024)}KB in ${tableTime}ms`);

                showStatus('comparison-status',
                    `‚úÖ Comparison complete! Individual: ${Math.round(individualBlob.size/1024)}KB (${individualTime}ms), Table: ${Math.round(tableBlob.size/1024)}KB (${tableTime}ms)`,
                    'success'
                );
            } catch (error) {
                showStatus('comparison-status', `‚ùå Comparison test failed: ${error.message}`, 'error');
            }
        }

        async function runPerformanceTest() {
            showStatus('comparison-status', 'üîÑ Running performance test with multiple scholarships...', 'info');

            const start = Date.now();
            const testScholarships = scholarships.slice(0, 18);

            try {
                const response = await fetch(`${API_URL}/api/admin/scholarships/generate`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        scholarships: testScholarships,
                        format: 'pdf',
                        orientation: 'landscape',
                        includeLinks: false,
                        template: 'table'
                    })
                });

                const elapsed = Date.now() - start;
                const blob = await response.blob();

                showStatus('comparison-status',
                    `‚úÖ Performance test: ${testScholarships.length} scholarships processed in ${elapsed}ms, generated ${Math.round(blob.size/1024)}KB PDF`,
                    'success'
                );
            } catch (error) {
                showStatus('comparison-status', `‚ùå Performance test failed: ${error.message}`, 'error');
            }
        }

        // Initialize
        window.onload = function() {
            document.getElementById('results-summary').innerHTML = `
                <h4>üéØ Conversion Features Status</h4>
                <p><strong>‚úÖ Table Form Conversion:</strong> 18 scholarships per page in 6√ó3 landscape grid</p>
                <p><strong>‚úÖ Individual Detail Conversion:</strong> Single scholarship per page in portrait mode</p>
                <p><strong>‚úÖ 25 Active Scholarships:</strong> All with future deadlines ready for conversion</p>
                <p><strong>‚úÖ Premium Features:</strong> 5 detailed scholarships with comprehensive information</p>
                <p><em>Login and run tests to verify functionality...</em></p>
            `;
        };
    </script>
</body>
</html>